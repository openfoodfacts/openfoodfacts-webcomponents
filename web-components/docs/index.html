<!doctype html>
<html>
  <head>
    <script type="module" src="https://jspm.dev/api-viewer-element"></script>
    <script type="module" src="https://jspm.dev/@api-viewer/docs"></script>
    <script type="module" src="off-webcomponents.bundled.js"></script>
    <style>
      /* Dark mode styles */
      :root {
        --bg-color: #ffffff;
        --text-color: #000000;
        --border-color: #e0e0e0;
        --link-color: #0066cc;
        --heading-color: #333333;
      }
      
      body.dark-mode {
        --bg-color: #1a1a1a;
        --text-color: #e0e0e0;
        --border-color: #333333;
        --link-color: #66b3ff;
        --heading-color: #ffffff;
      }
      
      body {
        background-color: var(--bg-color);
        color: var(--text-color);
        transition: background-color 0.3s ease, color 0.3s ease;
        font-family: Arial, sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 1rem;
      }
      
      h1, h2 {
        color: var(--heading-color);
      }
      
      a {
        color: var(--link-color);
      }
      
      .dark-mode-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        background: var(--link-color);
        color: var(--bg-color);
        border: none;
        border-radius: 50px;
        padding: 10px 15px;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        transition: background-color 0.3s ease;
        z-index: 1000;
      }
      
      .dark-mode-toggle:hover {
        opacity: 0.8;
      }
      
      /* API viewer dark mode support */
      body.dark-mode api-viewer,
      body.dark-mode api-docs {
        background-color: var(--bg-color);
        color: var(--text-color);
      }
    </style>
  </head>

  <body>
    <!-- Dark mode toggle button -->
    <button class="dark-mode-toggle" id="darkModeToggle">
      ðŸŒ™ Dark Mode
    </button>

    <!-- Configuration for the demo -->
    <off-webcomponents-configuration
      robotoff-configuration='{"dryRun": true}'
      assets-images-path="./assets/images"
    ></off-webcomponents-configuration>

    <h1>Open Food Facts Web Components</h1>
    <div style="margin-top: 2rem">
      <h2 id="off-webcomponents-configuration">
        Off Webcomponents Configuration <a href="#off-webcomponents-configuration">#</a>
      </h2>
      <api-docs src="custom-elements.json" only="off-webcomponents-configuration"></api-docs>
    </div>

    <div style="margin-top: 1rem">
      <h2 id="robotoff-question">Robotoff Question <a href="#robotoff-question">#</a></h2>
      <api-viewer src="custom-elements.json" only="robotoff-question"></api-viewer>
    </div>
    <div style="margin-top: 1rem">
      <h2 id="robotoff-nutrient-extraction">
        Robotoff Nutrient Extraction <a href="#robotoff-nutrient-extraction">#</a>
      </h2>
      <api-viewer src="custom-elements.json" only="robotoff-nutrient-extraction"></api-viewer>
    </div>

    <div style="margin-top: 1rem">
      <h2 id="robotoff-ingredient-spellcheck">
        Robotoff Ingredient Spellcheck <a href="#robotoff-ingredient-spellcheck">#</a>
      </h2>
      <api-viewer src="custom-elements.json" only="robotoff-ingredient-spellcheck"></api-viewer>
    </div>

    <div style="margin-top: 1rem">
      <h2 id="robotoff-ingredient-detection">
        Robotoff Ingredient Detection <a href="#robotoff-ingredient-detection">#</a>
      </h2>
      <api-viewer src="custom-elements.json" only="robotoff-ingredient-detection"></api-viewer>
    </div>

    <div style="margin-top: 1rem">
      <h2 id="donation-banner">Donation Banner <a href="#donation-banner">#</a></h2>
      <api-viewer src="custom-elements.json" only="donation-banner"></api-viewer>
    </div>

    <div style="margin-top: 1rem">
      <h2 id="mobile-badges">Mobile Badges <a href="#mobile-badges">#</a></h2>
      <api-viewer src="custom-elements.json" only="mobile-badges"></api-viewer>
    </div>

    <div style="margin-top: 1rem">
      <h2 id="download-app-qr-code">Download App QR Code <a href="#download-app-qr-code">#</a></h2>
      <api-viewer src="custom-elements.json" only="download-app-qr-code"></api-viewer>
    </div>

    <div style="margin-top: 1rem">
      <h2 id="barcode-scanner">Barcode Scanner <a href="#barcode-scanner">#</a></h2>
      <api-viewer src="custom-elements.json" only="barcode-scanner"></api-viewer>
    </div>

    <div style="margin-top: 1rem">
      <h2 id="folksonomy-editor">Foksonomy Editor <a href="#folksonomy-editor">#</a></h2>
      <api-viewer src="custom-elements.json" only="folksonomy-editor"></api-viewer>
    </div>

    <div style="margin-top: 1rem">
      <h2 id="robotoff-contribution-message">
        Robotoff Contribution Message <a href="#robotoff-contribution-message">#</a>
      </h2>
      <api-viewer src="custom-elements.json" only="robotoff-contribution-message"></api-viewer>
    </div>
    <div style="margin-top: 1rem">
      <h2 id="autocomplete-input">Autocomplete Input <a href="#autocomplete-input">#</a></h2>
      <api-viewer src="custom-elements.json" only="autocomplete-input"></api-viewer>
    </div>
    <div style="margin-top: 1rem">
      <h2 id="product-card">Product Card <a href="#product-card">#</a></h2>
      <api-viewer src="custom-elements.json" only="product-card"></api-viewer>
    </div>

    <script type="module">
      // Wait for the off-webcomponents.bundled.js to load first
      window.addEventListener('DOMContentLoaded', async () => {
        // Try to access the darkModeListener from the global scope or window
        let darkModeListener;
        
        // Simple fallback implementation if we can't import directly
        if (!window.darkModeListener) {
          // Create a simple version that works with localStorage
          const STORAGE_KEY = 'dark-mode-manual-override';
          
          darkModeListener = {
            isDark: false,
            listeners: new Set(),
            
            subscribe(callback) {
              this.listeners.add(callback);
              callback(this.isDark);
            },
            
            toggleDarkMode() {
              this.isDark = !this.isDark;
              localStorage.setItem(STORAGE_KEY, String(this.isDark));
              this.listeners.forEach(cb => cb(this.isDark));
            },
            
            init() {
              const stored = localStorage.getItem(STORAGE_KEY);
              if (stored !== null) {
                this.isDark = stored === 'true';
              } else {
                this.isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
              }
            }
          };
          
          darkModeListener.init();
          window.darkModeListener = darkModeListener;
        } else {
          darkModeListener = window.darkModeListener;
        }
        
        const toggleButton = document.getElementById('darkModeToggle');
        const body = document.body;
        
        // Initialize dark mode state
        function updateDarkMode(isDark) {
          if (isDark) {
            body.classList.add('dark-mode');
            toggleButton.textContent = 'â˜€ï¸ Light Mode';
          } else {
            body.classList.remove('dark-mode');
            toggleButton.textContent = 'ðŸŒ™ Dark Mode';
          }
        }
        
        // Subscribe to dark mode changes
        darkModeListener.subscribe(updateDarkMode);
        
        // Handle toggle button click
        toggleButton.addEventListener('click', () => {
          darkModeListener.toggleDarkMode();
        });
      });
    </script>
  </body>
</html>
